@model IEnumerable<Member>

@{
    ViewData["Title"] = "Add Member";
    var department = ViewBag.Department as StudentOrg_A4_Website.Models.Department;
}

<h1>Add Member to @department.DepartmentName</h1>

<a asp-action="Index" class="btn btn-secondary mb-3">← Back to Departments</a>

@if (Model.Any())
{
    <div class="mb-4">
        <select id="memberSelect" class="form-control" style="width: 100%;">
            <option value="">Search for a member...</option>
            @foreach (var member in Model)
            {
                <option value="@member.MemberId" data-name="@member.FirstName @member.LastName">
                    @member.FirstName @member.LastName - @member.Faculty
                </option>
            }
        </select>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Faculty</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var member in Model)
            {
                <tr>
                    <td>@member.FirstName @member.LastName</td>
                    <td>@member.Faculty</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-primary"
                                data-bs-toggle="modal"
                                data-bs-target="#addModal"
                                data-member-id="@member.MemberId"
                                data-member-name="@member.FirstName @member.LastName">
                            Add
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p class="text-muted">All members are already in this department.</p>
}

<div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Member</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Add <strong id="addModalMemberName"></strong> to <strong>@department.DepartmentName</strong>?</p>
            </div>
            <div class="modal-footer">
                <form asp-action="AddMember" asp-route-id="" method="post">
                    <input type="hidden" name="memberId" id="addModalMemberId" />
                    <input type="hidden" name="departmentId" value="@department.DepartmentId" />
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </form>
            </div>
        </div>
    </div>
</div>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        $('#memberSelect').select2({
            theme: 'bootstrap-5',
            placeholder: 'Search for a member...',
            allowClear: true
        });

        $('#memberSelect').on('select2:select', function (e) {
            var memberId = e.params.data.id;
            var memberName = e.params.data.text.split(' - ')[0];

            document.getElementById('addModalMemberId').value = memberId;
            document.getElementById('addModalMemberName').textContent = memberName;

            var modal = new bootstrap.Modal(document.getElementById('addModal'));
            modal.show();
        });

        document.getElementById('addModal').addEventListener('hidden.bs.modal', function () {
            $('#memberSelect').val(null).trigger('change');
        });
    });

    document.getElementById('addModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        if (button) {
            document.getElementById('addModalMemberId').value = button.getAttribute('data-member-id');
            document.getElementById('addModalMemberName').textContent = button.getAttribute('data-member-name');
        }
    });
</script>

